{"remainingRequest":"/Users/zsy/Projects/about_me/node_modules/thread-loader/dist/cjs.js!/Users/zsy/Projects/about_me/node_modules/babel-loader/lib/index.js!/Users/zsy/Projects/about_me/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/zsy/Projects/about_me/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zsy/Projects/about_me/node_modules/healen-x-ui/packages/sku/Sku.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zsy/Projects/about_me/node_modules/healen-x-ui/packages/sku/Sku.vue","mtime":499162500000},{"path":"/Users/zsy/Projects/about_me/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zsy/Projects/about_me/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zsy/Projects/about_me/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zsy/Projects/about_me/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zsy/Projects/about_me/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _defineProperty from \"/Users/zsy/Projects/about_me/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/Users/zsy/Projects/about_me/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/* eslint-disable camelcase */\nimport Vue from 'vue';\nimport Popup from '../popup';\nimport Toast from '../toast';\nimport SkuHeader from './components/SkuHeader';\nimport SkuRow from './components/SkuRow';\nimport SkuRowItem from './components/SkuRowItem';\nimport SkuStepper from './components/SkuStepper';\nimport SkuMessages from './components/SkuMessages';\nimport SkuActions from './components/SkuActions';\nimport { isAllSelected, isSkuChoosable, getSkuComb, getSelectedSkuValues } from './utils/skuHelper';\nimport { LIMIT_TYPE, UNSELECTED_SKU_VALUE_ID } from './constants';\nimport create from '../utils/create';\nvar QUOTA_LIMIT = LIMIT_TYPE.QUOTA_LIMIT;\nexport default create({\n  name: 'sku',\n  components: {\n    Popup: Popup,\n    SkuHeader: SkuHeader,\n    SkuRow: SkuRow,\n    SkuRowItem: SkuRowItem,\n    SkuStepper: SkuStepper,\n    SkuMessages: SkuMessages,\n    SkuActions: SkuActions\n  },\n  props: {\n    sku: Object,\n    goods: Object,\n    value: Boolean,\n    buyText: String,\n    goodsId: [Number, String],\n    stepperTitle: String,\n    hideStock: Boolean,\n    getContainer: Function,\n    resetStepperOnHide: Boolean,\n    resetSelectedSkuOnHide: Boolean,\n    disableStepperInput: Boolean,\n    closeOnClickOverlay: Boolean,\n    initialSku: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    quota: {\n      type: Number,\n      default: 0\n    },\n    quotaUsed: {\n      type: Number,\n      default: 0\n    },\n    showAddCartBtn: {\n      type: Boolean,\n      default: true\n    },\n    bodyOffsetTop: {\n      type: Number,\n      default: 200\n    },\n    messageConfig: {\n      type: Object,\n      default: function _default() {\n        return {\n          placeholderMap: {},\n          uploadImg: function uploadImg() {\n            return Promise.resolve();\n          },\n          uploadMaxSize: 5\n        };\n      }\n    },\n    customStepperConfig: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    customSkuValidator: Function\n  },\n  data: function data() {\n    return {\n      selectedSku: {},\n      selectedNum: 1,\n      show: this.value\n    };\n  },\n  watch: {\n    show: function show(val) {\n      this.$emit('input', val);\n\n      if (!val) {\n        var selectedSkuValues = getSelectedSkuValues(this.sku.tree, this.selectedSku);\n        this.$emit('sku-close', {\n          selectedSkuValues: selectedSkuValues,\n          selectedNum: this.selectedNum,\n          selectedSkuComb: this.selectedSkuComb\n        });\n\n        if (this.resetStepperOnHide) {\n          this.$refs.skuStepper && this.$refs.skuStepper.setCurrentNum(1);\n        }\n\n        if (this.resetSelectedSkuOnHide) {\n          this.resetSelectedSku(this.skuTree);\n        }\n      }\n    },\n    value: function value(val) {\n      this.show = val;\n    },\n    skuTree: function skuTree(val) {\n      this.resetSelectedSku(val);\n    }\n  },\n  computed: {\n    bodyStyle: function bodyStyle() {\n      if (this.$isServer) {\n        return;\n      } // header高度82px, sku actions高度50px，如果改动了样式自己传下bodyOffsetTop调整下\n\n\n      var maxHeight = window.innerHeight - this.bodyOffsetTop;\n      return {\n        maxHeight: maxHeight + 'px'\n      };\n    },\n    isSkuCombSelected: function isSkuCombSelected() {\n      return isAllSelected(this.sku.tree, this.selectedSku);\n    },\n    isSkuEmpty: function isSkuEmpty() {\n      return Object.keys(this.sku).length === 0;\n    },\n    hasSku: function hasSku() {\n      return !this.sku.none_sku;\n    },\n    selectedSkuComb: function selectedSkuComb() {\n      if (!this.hasSku) {\n        return {\n          id: this.sku.collection_id,\n          price: Math.round(this.sku.price * 100),\n          stock_num: this.sku.stock_num\n        };\n      } else if (this.isSkuCombSelected) {\n        return getSkuComb(this.sku.list, this.selectedSku);\n      }\n\n      return null;\n    },\n    price: function price() {\n      if (this.selectedSkuComb) {\n        return (this.selectedSkuComb.price / 100).toFixed(2);\n      } // sku.price是一个格式化好的价格区间\n\n\n      return this.sku.price;\n    },\n    skuTree: function skuTree() {\n      return this.sku.tree || [];\n    }\n  },\n  created: function created() {\n    var skuEventBus = new Vue();\n    this.skuEventBus = skuEventBus;\n    skuEventBus.$on('sku:close', this.onClose);\n    skuEventBus.$on('sku:select', this.onSelect);\n    skuEventBus.$on('sku:numChange', this.onNumChange);\n    skuEventBus.$on('sku:overLimit', this.onOverLimit);\n    skuEventBus.$on('sku:addCart', this.onAddCart);\n    skuEventBus.$on('sku:buy', this.onBuy);\n    this.resetSelectedSku(this.skuTree); // 组件初始化后的钩子，抛出skuEventBus\n\n    this.$emit('after-sku-create', skuEventBus);\n  },\n  methods: {\n    resetSelectedSku: function resetSelectedSku(skuTree) {\n      var _this = this;\n\n      this.selectedSku = {}; // 重置selectedSku\n\n      skuTree.forEach(function (item) {\n        _this.selectedSku[item.k_s] = _this.initialSku[item.k_s] || UNSELECTED_SKU_VALUE_ID;\n      }); // 只有一个sku规格值时默认选中\n\n      skuTree.forEach(function (item) {\n        var key = item.k_s;\n        var valueId = item.v[0].id;\n\n        if (item.v.length === 1 && isSkuChoosable(_this.sku.list, _this.selectedSku, {\n          key: key,\n          valueId: valueId\n        })) {\n          _this.selectedSku[key] = valueId;\n        }\n      });\n    },\n    getSkuMessages: function getSkuMessages() {\n      return this.$refs.skuMessages ? this.$refs.skuMessages.getMessages() : {};\n    },\n    getSkuCartMessages: function getSkuCartMessages() {\n      return this.$refs.skuMessages ? this.$refs.skuMessages.getCartMessages() : {};\n    },\n    validateSkuMessages: function validateSkuMessages() {\n      return this.$refs.skuMessages ? this.$refs.skuMessages.validateMessages() : '';\n    },\n    validateSku: function validateSku() {\n      if (this.selectedNum === 0) {\n        return '商品已经无法购买啦';\n      }\n\n      if (this.isSkuCombSelected) {\n        return this.validateSkuMessages();\n      } // 自定义sku校验\n\n\n      if (this.customSkuValidator) {\n        var err = this.customSkuValidator(this);\n        if (err) return err;\n      }\n\n      return '请先选择商品规格';\n    },\n    onClose: function onClose() {\n      this.show = false;\n    },\n    onSelect: function onSelect(skuValue) {\n      // 点击已选中的sku时则取消选中\n      this.selectedSku = this.selectedSku[skuValue.skuKeyStr] === skuValue.id ? _objectSpread({}, this.selectedSku, _defineProperty({}, skuValue.skuKeyStr, UNSELECTED_SKU_VALUE_ID)) : _objectSpread({}, this.selectedSku, _defineProperty({}, skuValue.skuKeyStr, skuValue.id));\n      this.$emit('sku-selected', {\n        skuValue: skuValue,\n        selectedSku: this.selectedSku,\n        selectedSkuComb: this.selectedSkuComb\n      });\n    },\n    onNumChange: function onNumChange(num) {\n      this.selectedNum = num;\n    },\n    onOverLimit: function onOverLimit(data) {\n      var action = data.action,\n          limitType = data.limitType,\n          quota = data.quota,\n          quotaUsed = data.quotaUsed;\n      var handleOverLimit = this.customStepperConfig.handleOverLimit;\n\n      if (handleOverLimit) {\n        handleOverLimit(data);\n        return;\n      }\n\n      if (action === 'minus') {\n        Toast('至少选择一件');\n      } else if (action === 'plus') {\n        if (limitType === QUOTA_LIMIT) {\n          var msg = \"\\u9650\\u8D2D\".concat(quota, \"\\u4EF6\");\n          if (quotaUsed > 0) msg += \"\\uFF0C\".concat(\"\\u4F60\\u5DF2\\u8D2D\\u4E70\".concat(quotaUsed, \"\\u4EF6\"));\n          Toast(msg);\n        } else {\n          Toast('库存不足');\n        }\n      }\n    },\n    onAddCart: function onAddCart() {\n      this.onBuyOrAddCart('add-cart');\n    },\n    onBuy: function onBuy() {\n      this.onBuyOrAddCart('buy-clicked');\n    },\n    onBuyOrAddCart: function onBuyOrAddCart(type) {\n      var error = this.validateSku();\n\n      if (error) {\n        Toast(error);\n      } else {\n        this.$emit(type, this.getSkuData());\n      }\n    },\n    getSkuData: function getSkuData() {\n      return {\n        goodsId: this.goodsId,\n        selectedNum: this.selectedNum,\n        selectedSkuComb: this.selectedSkuComb,\n        messages: this.getSkuMessages(),\n        cartMessages: this.getSkuCartMessages()\n      };\n    }\n  }\n});",{"version":3,"sources":["Sku.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwGA;AACA,OAAA,GAAA,MAAA,KAAA;AACA,OAAA,KAAA,MAAA,UAAA;AACA,OAAA,KAAA,MAAA,UAAA;AACA,OAAA,SAAA,MAAA,wBAAA;AACA,OAAA,MAAA,MAAA,qBAAA;AACA,OAAA,UAAA,MAAA,yBAAA;AACA,OAAA,UAAA,MAAA,yBAAA;AACA,OAAA,WAAA,MAAA,0BAAA;AACA,OAAA,UAAA,MAAA,yBAAA;AACA,SACA,aADA,EAEA,cAFA,EAGA,UAHA,EAIA,oBAJA,QAKA,mBALA;AAMA,SAAA,UAAA,EAAA,uBAAA,QAAA,aAAA;AACA,OAAA,MAAA,MAAA,iBAAA;IAEA,W,GAAA,U,CAAA,W;AAEA,eAAA,MAAA,CAAA;AACA,EAAA,IAAA,EAAA,KADA;AAGA,EAAA,UAAA,EAAA;AACA,IAAA,KAAA,EAAA,KADA;AAEA,IAAA,SAAA,EAAA,SAFA;AAGA,IAAA,MAAA,EAAA,MAHA;AAIA,IAAA,UAAA,EAAA,UAJA;AAKA,IAAA,UAAA,EAAA,UALA;AAMA,IAAA,WAAA,EAAA,WANA;AAOA,IAAA,UAAA,EAAA;AAPA,GAHA;AAaA,EAAA,KAAA,EAAA;AACA,IAAA,GAAA,EAAA,MADA;AAEA,IAAA,KAAA,EAAA,MAFA;AAGA,IAAA,KAAA,EAAA,OAHA;AAIA,IAAA,OAAA,EAAA,MAJA;AAKA,IAAA,OAAA,EAAA,CAAA,MAAA,EAAA,MAAA,CALA;AAMA,IAAA,YAAA,EAAA,MANA;AAOA,IAAA,SAAA,EAAA,OAPA;AAQA,IAAA,YAAA,EAAA,QARA;AASA,IAAA,kBAAA,EAAA,OATA;AAUA,IAAA,sBAAA,EAAA,OAVA;AAWA,IAAA,mBAAA,EAAA,OAXA;AAYA,IAAA,mBAAA,EAAA,OAZA;AAaA,IAAA,UAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA;AAAA,eAAA,EAAA;AAAA;AAFA,KAbA;AAiBA,IAAA,KAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA;AAFA,KAjBA;AAqBA,IAAA,SAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA;AAFA,KArBA;AAyBA,IAAA,cAAA,EAAA;AACA,MAAA,IAAA,EAAA,OADA;AAEA,MAAA,OAAA,EAAA;AAFA,KAzBA;AA6BA,IAAA,aAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA;AAFA,KA7BA;AAiCA,IAAA,aAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA;AAAA,eAAA;AACA,UAAA,cAAA,EAAA,EADA;AAEA,UAAA,SAAA,EAAA;AAAA,mBAAA,OAAA,CAAA,OAAA,EAAA;AAAA,WAFA;AAGA,UAAA,aAAA,EAAA;AAHA,SAAA;AAAA;AAFA,KAjCA;AAyCA,IAAA,mBAAA,EAAA;AACA,MAAA,IAAA,EAAA,MADA;AAEA,MAAA,OAAA,EAAA;AAAA,eAAA,EAAA;AAAA;AAFA,KAzCA;AA6CA,IAAA,kBAAA,EAAA;AA7CA,GAbA;AA6DA,EAAA,IA7DA,kBA6DA;AACA,WAAA;AACA,MAAA,WAAA,EAAA,EADA;AAEA,MAAA,WAAA,EAAA,CAFA;AAGA,MAAA,IAAA,EAAA,KAAA;AAHA,KAAA;AAKA,GAnEA;AAqEA,EAAA,KAAA,EAAA;AACA,IAAA,IADA,gBACA,GADA,EACA;AACA,WAAA,KAAA,CAAA,OAAA,EAAA,GAAA;;AACA,UAAA,CAAA,GAAA,EAAA;AACA,YAAA,iBAAA,GAAA,oBAAA,CACA,KAAA,GAAA,CAAA,IADA,EAEA,KAAA,WAFA,CAAA;AAKA,aAAA,KAAA,CAAA,WAAA,EAAA;AACA,UAAA,iBAAA,EAAA,iBADA;AAEA,UAAA,WAAA,EAAA,KAAA,WAFA;AAGA,UAAA,eAAA,EAAA,KAAA;AAHA,SAAA;;AAMA,YAAA,KAAA,kBAAA,EAAA;AACA,eAAA,KAAA,CAAA,UAAA,IAAA,KAAA,KAAA,CAAA,UAAA,CAAA,aAAA,CAAA,CAAA,CAAA;AACA;;AAEA,YAAA,KAAA,sBAAA,EAAA;AACA,eAAA,gBAAA,CAAA,KAAA,OAAA;AACA;AACA;AACA,KAvBA;AAwBA,IAAA,KAxBA,iBAwBA,GAxBA,EAwBA;AACA,WAAA,IAAA,GAAA,GAAA;AACA,KA1BA;AA2BA,IAAA,OA3BA,mBA2BA,GA3BA,EA2BA;AACA,WAAA,gBAAA,CAAA,GAAA;AACA;AA7BA,GArEA;AAqGA,EAAA,QAAA,EAAA;AACA,IAAA,SADA,uBACA;AACA,UAAA,KAAA,SAAA,EAAA;AACA;AACA,OAHA,CAKA;;;AACA,UAAA,SAAA,GAAA,MAAA,CAAA,WAAA,GAAA,KAAA,aAAA;AAEA,aAAA;AACA,QAAA,SAAA,EAAA,SAAA,GAAA;AADA,OAAA;AAGA,KAZA;AAcA,IAAA,iBAdA,+BAcA;AACA,aAAA,aAAA,CAAA,KAAA,GAAA,CAAA,IAAA,EAAA,KAAA,WAAA,CAAA;AACA,KAhBA;AAkBA,IAAA,UAlBA,wBAkBA;AACA,aAAA,MAAA,CAAA,IAAA,CAAA,KAAA,GAAA,EAAA,MAAA,KAAA,CAAA;AACA,KApBA;AAsBA,IAAA,MAtBA,oBAsBA;AACA,aAAA,CAAA,KAAA,GAAA,CAAA,QAAA;AACA,KAxBA;AA0BA,IAAA,eA1BA,6BA0BA;AACA,UAAA,CAAA,KAAA,MAAA,EAAA;AACA,eAAA;AACA,UAAA,EAAA,EAAA,KAAA,GAAA,CAAA,aADA;AAEA,UAAA,KAAA,EAAA,IAAA,CAAA,KAAA,CAAA,KAAA,GAAA,CAAA,KAAA,GAAA,GAAA,CAFA;AAGA,UAAA,SAAA,EAAA,KAAA,GAAA,CAAA;AAHA,SAAA;AAKA,OANA,MAMA,IAAA,KAAA,iBAAA,EAAA;AACA,eAAA,UAAA,CAAA,KAAA,GAAA,CAAA,IAAA,EAAA,KAAA,WAAA,CAAA;AACA;;AACA,aAAA,IAAA;AACA,KArCA;AAuCA,IAAA,KAvCA,mBAuCA;AACA,UAAA,KAAA,eAAA,EAAA;AACA,eAAA,CAAA,KAAA,eAAA,CAAA,KAAA,GAAA,GAAA,EAAA,OAAA,CAAA,CAAA,CAAA;AACA,OAHA,CAIA;;;AACA,aAAA,KAAA,GAAA,CAAA,KAAA;AACA,KA7CA;AA+CA,IAAA,OA/CA,qBA+CA;AACA,aAAA,KAAA,GAAA,CAAA,IAAA,IAAA,EAAA;AACA;AAjDA,GArGA;AAyJA,EAAA,OAzJA,qBAyJA;AACA,QAAA,WAAA,GAAA,IAAA,GAAA,EAAA;AACA,SAAA,WAAA,GAAA,WAAA;AAEA,IAAA,WAAA,CAAA,GAAA,CAAA,WAAA,EAAA,KAAA,OAAA;AACA,IAAA,WAAA,CAAA,GAAA,CAAA,YAAA,EAAA,KAAA,QAAA;AACA,IAAA,WAAA,CAAA,GAAA,CAAA,eAAA,EAAA,KAAA,WAAA;AACA,IAAA,WAAA,CAAA,GAAA,CAAA,eAAA,EAAA,KAAA,WAAA;AACA,IAAA,WAAA,CAAA,GAAA,CAAA,aAAA,EAAA,KAAA,SAAA;AACA,IAAA,WAAA,CAAA,GAAA,CAAA,SAAA,EAAA,KAAA,KAAA;AAEA,SAAA,gBAAA,CAAA,KAAA,OAAA,EAXA,CAYA;;AACA,SAAA,KAAA,CAAA,kBAAA,EAAA,WAAA;AACA,GAvKA;AAyKA,EAAA,OAAA,EAAA;AACA,IAAA,gBADA,4BACA,OADA,EACA;AAAA;;AACA,WAAA,WAAA,GAAA,EAAA,CADA,CAEA;;AACA,MAAA,OAAA,CAAA,OAAA,CAAA,UAAA,IAAA,EAAA;AACA,QAAA,KAAA,CAAA,WAAA,CAAA,IAAA,CAAA,GAAA,IAAA,KAAA,CAAA,UAAA,CAAA,IAAA,CAAA,GAAA,KAAA,uBAAA;AACA,OAFA,EAHA,CAMA;;AACA,MAAA,OAAA,CAAA,OAAA,CAAA,UAAA,IAAA,EAAA;AACA,YAAA,GAAA,GAAA,IAAA,CAAA,GAAA;AACA,YAAA,OAAA,GAAA,IAAA,CAAA,CAAA,CAAA,CAAA,EAAA,EAAA;;AACA,YACA,IAAA,CAAA,CAAA,CAAA,MAAA,KAAA,CAAA,IACA,cAAA,CAAA,KAAA,CAAA,GAAA,CAAA,IAAA,EAAA,KAAA,CAAA,WAAA,EAAA;AAAA,UAAA,GAAA,EAAA,GAAA;AAAA,UAAA,OAAA,EAAA;AAAA,SAAA,CAFA,EAGA;AACA,UAAA,KAAA,CAAA,WAAA,CAAA,GAAA,IAAA,OAAA;AACA;AACA,OATA;AAUA,KAlBA;AAoBA,IAAA,cApBA,4BAoBA;AACA,aAAA,KAAA,KAAA,CAAA,WAAA,GAAA,KAAA,KAAA,CAAA,WAAA,CAAA,WAAA,EAAA,GAAA,EAAA;AACA,KAtBA;AAwBA,IAAA,kBAxBA,gCAwBA;AACA,aAAA,KAAA,KAAA,CAAA,WAAA,GACA,KAAA,KAAA,CAAA,WAAA,CAAA,eAAA,EADA,GAEA,EAFA;AAGA,KA5BA;AA8BA,IAAA,mBA9BA,iCA8BA;AACA,aAAA,KAAA,KAAA,CAAA,WAAA,GACA,KAAA,KAAA,CAAA,WAAA,CAAA,gBAAA,EADA,GAEA,EAFA;AAGA,KAlCA;AAoCA,IAAA,WApCA,yBAoCA;AACA,UAAA,KAAA,WAAA,KAAA,CAAA,EAAA;AACA,eAAA,WAAA;AACA;;AAEA,UAAA,KAAA,iBAAA,EAAA;AACA,eAAA,KAAA,mBAAA,EAAA;AACA,OAPA,CASA;;;AACA,UAAA,KAAA,kBAAA,EAAA;AACA,YAAA,GAAA,GAAA,KAAA,kBAAA,CAAA,IAAA,CAAA;AACA,YAAA,GAAA,EAAA,OAAA,GAAA;AACA;;AAEA,aAAA,UAAA;AACA,KApDA;AAsDA,IAAA,OAtDA,qBAsDA;AACA,WAAA,IAAA,GAAA,KAAA;AACA,KAxDA;AA0DA,IAAA,QA1DA,oBA0DA,QA1DA,EA0DA;AACA;AACA,WAAA,WAAA,GACA,KAAA,WAAA,CAAA,QAAA,CAAA,SAAA,MAAA,QAAA,CAAA,EAAA,qBACA,KAAA,WADA,sBACA,QAAA,CAAA,SADA,EACA,uBADA,uBAEA,KAAA,WAFA,sBAEA,QAAA,CAAA,SAFA,EAEA,QAAA,CAAA,EAFA,EADA;AAKA,WAAA,KAAA,CAAA,cAAA,EAAA;AACA,QAAA,QAAA,EAAA,QADA;AAEA,QAAA,WAAA,EAAA,KAAA,WAFA;AAGA,QAAA,eAAA,EAAA,KAAA;AAHA,OAAA;AAKA,KAtEA;AAwEA,IAAA,WAxEA,uBAwEA,GAxEA,EAwEA;AACA,WAAA,WAAA,GAAA,GAAA;AACA,KA1EA;AA4EA,IAAA,WA5EA,uBA4EA,IA5EA,EA4EA;AAAA,UACA,MADA,GACA,IADA,CACA,MADA;AAAA,UACA,SADA,GACA,IADA,CACA,SADA;AAAA,UACA,KADA,GACA,IADA,CACA,KADA;AAAA,UACA,SADA,GACA,IADA,CACA,SADA;AAAA,UAEA,eAFA,GAEA,KAAA,mBAFA,CAEA,eAFA;;AAIA,UAAA,eAAA,EAAA;AACA,QAAA,eAAA,CAAA,IAAA,CAAA;AACA;AACA;;AAEA,UAAA,MAAA,KAAA,OAAA,EAAA;AACA,QAAA,KAAA,CAAA,QAAA,CAAA;AACA,OAFA,MAEA,IAAA,MAAA,KAAA,MAAA,EAAA;AACA,YAAA,SAAA,KAAA,WAAA,EAAA;AACA,cAAA,GAAA,yBAAA,KAAA,WAAA;AACA,cAAA,SAAA,GAAA,CAAA,EAAA,GAAA,sDAAA,SAAA,YAAA;AACA,UAAA,KAAA,CAAA,GAAA,CAAA;AACA,SAJA,MAIA;AACA,UAAA,KAAA,CAAA,MAAA,CAAA;AACA;AACA;AACA,KAhGA;AAkGA,IAAA,SAlGA,uBAkGA;AACA,WAAA,cAAA,CAAA,UAAA;AACA,KApGA;AAsGA,IAAA,KAtGA,mBAsGA;AACA,WAAA,cAAA,CAAA,aAAA;AACA,KAxGA;AA0GA,IAAA,cA1GA,0BA0GA,IA1GA,EA0GA;AACA,UAAA,KAAA,GAAA,KAAA,WAAA,EAAA;;AACA,UAAA,KAAA,EAAA;AACA,QAAA,KAAA,CAAA,KAAA,CAAA;AACA,OAFA,MAEA;AACA,aAAA,KAAA,CAAA,IAAA,EAAA,KAAA,UAAA,EAAA;AACA;AACA,KAjHA;AAmHA,IAAA,UAnHA,wBAmHA;AACA,aAAA;AACA,QAAA,OAAA,EAAA,KAAA,OADA;AAEA,QAAA,WAAA,EAAA,KAAA,WAFA;AAGA,QAAA,eAAA,EAAA,KAAA,eAHA;AAIA,QAAA,QAAA,EAAA,KAAA,cAAA,EAJA;AAKA,QAAA,YAAA,EAAA,KAAA,kBAAA;AALA,OAAA;AAOA;AA3HA;AAzKA,CAAA,CAAA","sourcesContent":["<template>\n  <popup\n    v-if=\"!isSkuEmpty\"\n    v-model=\"show\"\n    position=\"bottom\"\n    class=\"van-sku-container\"\n    :close-on-click-overlay=\"closeOnClickOverlay\"\n    :get-container=\"getContainer\"\n  >\n    <!-- sku-header -->\n    <slot\n      name=\"sku-header\"\n      :sku-event-bus=\"skuEventBus\"\n      :selected-sku=\"selectedSku\"\n      :selected-sku-comb=\"selectedSkuComb\"\n    >\n      <sku-header\n        :sku-event-bus=\"skuEventBus\"\n        :selected-sku=\"selectedSku\"\n        :goods=\"goods\"\n        :sku=\"sku\"\n      >\n        <slot\n          name=\"sku-header-price\"\n          :price=\"price\"\n          :selected-sku-comb=\"selectedSkuComb\"\n        >\n          <div class=\"van-sku__goods-price\">\n            <span class=\"van-sku__price-symbol\">￥</span><span class=\"van-sku__price-num\">{{ price }}</span>\n          </div>\n        </slot>\n      </sku-header>\n    </slot>\n    <div class=\"van-sku-body\" :style=\"bodyStyle\">\n      <!-- sku-body-top -->\n      <slot name=\"sku-body-top\" :selected-sku=\"selectedSku\" :sku-event-bus=\"skuEventBus\" />\n      <!-- sku-group -->\n      <slot name=\"sku-group\" :selected-sku=\"selectedSku\" :sku-event-bus=\"skuEventBus\">\n        <div v-if=\"hasSku\" class=\"van-sku-group-container van-hairline--bottom\">\n          <sku-row\n            v-for=\"(skuTreeItem, index) in skuTree\"\n            :key=\"index\"\n            :sku-row=\"skuTreeItem\"\n          >\n            <sku-row-item\n              v-for=\"(skuValue, index) in skuTreeItem.v\"\n              :key=\"index\"\n              :sku-key-str=\"skuTreeItem.k_s\"\n              :sku-value=\"skuValue\"\n              :sku-event-bus=\"skuEventBus\"\n              :selected-sku=\"selectedSku\"\n              :sku-list=\"sku.list\"\n            />\n          </sku-row>\n        </div>\n      </slot>\n      <!-- extra-sku-group -->\n      <slot name=\"extra-sku-group\" :sku-event-bus=\"skuEventBus\"/>\n      <!-- sku-stepper -->\n      <slot\n        name=\"sku-stepper\"\n        :sku-event-bus=\"skuEventBus\"\n        :selected-sku=\"selectedSku\"\n        :selected-sku-comb=\"selectedSkuComb\"\n        :selected-num=\"selectedNum\"\n      >\n        <sku-stepper\n          ref=\"skuStepper\"\n          :sku-event-bus=\"skuEventBus\"\n          :selected-sku=\"selectedSku\"\n          :selected-sku-comb=\"selectedSkuComb\"\n          :selected-num=\"selectedNum\"\n          :stepper-title=\"stepperTitle\"\n          :sku-stock-num=\"sku.stock_num\"\n          :quota=\"quota\"\n          :quota-used=\"quotaUsed\"\n          :disable-stepper-input=\"disableStepperInput\"\n          :hide-stock=\"hideStock\"\n          :custom-stepper-config=\"customStepperConfig\"\n          @change=\"$emit('stepper-change', $event)\"\n        />\n      </slot>\n      <!-- sku-messages -->\n      <slot name=\"sku-messages\">\n        <sku-messages\n          ref=\"skuMessages\"\n          :goods-id=\"goodsId\"\n          :message-config=\"messageConfig\"\n          :messages=\"sku.messages\"\n        />\n      </slot>\n    </div>\n    <!-- sku-actions -->\n    <slot name=\"sku-actions\" :sku-event-bus=\"skuEventBus\">\n      <sku-actions\n        :sku-event-bus=\"skuEventBus\"\n        :buy-text=\"buyText\"\n        :show-add-cart-btn=\"showAddCartBtn\"\n      />\n    </slot>\n  </popup>\n</template>\n\n<script>\n/* eslint-disable camelcase */\nimport Vue from 'vue';\nimport Popup from '../popup';\nimport Toast from '../toast';\nimport SkuHeader from './components/SkuHeader';\nimport SkuRow from './components/SkuRow';\nimport SkuRowItem from './components/SkuRowItem';\nimport SkuStepper from './components/SkuStepper';\nimport SkuMessages from './components/SkuMessages';\nimport SkuActions from './components/SkuActions';\nimport {\n  isAllSelected,\n  isSkuChoosable,\n  getSkuComb,\n  getSelectedSkuValues\n} from './utils/skuHelper';\nimport { LIMIT_TYPE, UNSELECTED_SKU_VALUE_ID } from './constants';\nimport create from '../utils/create';\n\nconst { QUOTA_LIMIT } = LIMIT_TYPE;\n\nexport default create({\n  name: 'sku',\n\n  components: {\n    Popup,\n    SkuHeader,\n    SkuRow,\n    SkuRowItem,\n    SkuStepper,\n    SkuMessages,\n    SkuActions\n  },\n\n  props: {\n    sku: Object,\n    goods: Object,\n    value: Boolean,\n    buyText: String,\n    goodsId: [Number, String],\n    stepperTitle: String,\n    hideStock: Boolean,\n    getContainer: Function,\n    resetStepperOnHide: Boolean,\n    resetSelectedSkuOnHide: Boolean,\n    disableStepperInput: Boolean,\n    closeOnClickOverlay: Boolean,\n    initialSku: {\n      type: Object,\n      default: () => ({})\n    },\n    quota: {\n      type: Number,\n      default: 0\n    },\n    quotaUsed: {\n      type: Number,\n      default: 0\n    },\n    showAddCartBtn: {\n      type: Boolean,\n      default: true\n    },\n    bodyOffsetTop: {\n      type: Number,\n      default: 200\n    },\n    messageConfig: {\n      type: Object,\n      default: () => ({\n        placeholderMap: {},\n        uploadImg: () => Promise.resolve(),\n        uploadMaxSize: 5\n      })\n    },\n    customStepperConfig: {\n      type: Object,\n      default: () => ({})\n    },\n    customSkuValidator: Function\n  },\n\n  data() {\n    return {\n      selectedSku: {},\n      selectedNum: 1,\n      show: this.value\n    };\n  },\n\n  watch: {\n    show(val) {\n      this.$emit('input', val);\n      if (!val) {\n        const selectedSkuValues = getSelectedSkuValues(\n          this.sku.tree,\n          this.selectedSku\n        );\n\n        this.$emit('sku-close', {\n          selectedSkuValues,\n          selectedNum: this.selectedNum,\n          selectedSkuComb: this.selectedSkuComb\n        });\n\n        if (this.resetStepperOnHide) {\n          this.$refs.skuStepper && this.$refs.skuStepper.setCurrentNum(1);\n        }\n\n        if (this.resetSelectedSkuOnHide) {\n          this.resetSelectedSku(this.skuTree);\n        }\n      }\n    },\n    value(val) {\n      this.show = val;\n    },\n    skuTree(val) {\n      this.resetSelectedSku(val);\n    }\n  },\n\n  computed: {\n    bodyStyle() {\n      if (this.$isServer) {\n        return;\n      }\n\n      // header高度82px, sku actions高度50px，如果改动了样式自己传下bodyOffsetTop调整下\n      const maxHeight = window.innerHeight - this.bodyOffsetTop;\n\n      return {\n        maxHeight: maxHeight + 'px'\n      };\n    },\n\n    isSkuCombSelected() {\n      return isAllSelected(this.sku.tree, this.selectedSku);\n    },\n\n    isSkuEmpty() {\n      return Object.keys(this.sku).length === 0;\n    },\n\n    hasSku() {\n      return !this.sku.none_sku;\n    },\n\n    selectedSkuComb() {\n      if (!this.hasSku) {\n        return {\n          id: this.sku.collection_id,\n          price: Math.round(this.sku.price * 100),\n          stock_num: this.sku.stock_num\n        };\n      } else if (this.isSkuCombSelected) {\n        return getSkuComb(this.sku.list, this.selectedSku);\n      }\n      return null;\n    },\n\n    price() {\n      if (this.selectedSkuComb) {\n        return (this.selectedSkuComb.price / 100).toFixed(2);\n      }\n      // sku.price是一个格式化好的价格区间\n      return this.sku.price;\n    },\n\n    skuTree() {\n      return this.sku.tree || [];\n    }\n  },\n\n  created() {\n    const skuEventBus = new Vue();\n    this.skuEventBus = skuEventBus;\n\n    skuEventBus.$on('sku:close', this.onClose);\n    skuEventBus.$on('sku:select', this.onSelect);\n    skuEventBus.$on('sku:numChange', this.onNumChange);\n    skuEventBus.$on('sku:overLimit', this.onOverLimit);\n    skuEventBus.$on('sku:addCart', this.onAddCart);\n    skuEventBus.$on('sku:buy', this.onBuy);\n\n    this.resetSelectedSku(this.skuTree);\n    // 组件初始化后的钩子，抛出skuEventBus\n    this.$emit('after-sku-create', skuEventBus);\n  },\n\n  methods: {\n    resetSelectedSku(skuTree) {\n      this.selectedSku = {};\n      // 重置selectedSku\n      skuTree.forEach(item => {\n        this.selectedSku[item.k_s] = this.initialSku[item.k_s] || UNSELECTED_SKU_VALUE_ID;\n      });\n      // 只有一个sku规格值时默认选中\n      skuTree.forEach(item => {\n        const key = item.k_s;\n        const valueId = item.v[0].id;\n        if (\n          item.v.length === 1 &&\n          isSkuChoosable(this.sku.list, this.selectedSku, { key, valueId })\n        ) {\n          this.selectedSku[key] = valueId;\n        }\n      });\n    },\n\n    getSkuMessages() {\n      return this.$refs.skuMessages ? this.$refs.skuMessages.getMessages() : {};\n    },\n\n    getSkuCartMessages() {\n      return this.$refs.skuMessages\n        ? this.$refs.skuMessages.getCartMessages()\n        : {};\n    },\n\n    validateSkuMessages() {\n      return this.$refs.skuMessages\n        ? this.$refs.skuMessages.validateMessages()\n        : '';\n    },\n\n    validateSku() {\n      if (this.selectedNum === 0) {\n        return '商品已经无法购买啦';\n      }\n\n      if (this.isSkuCombSelected) {\n        return this.validateSkuMessages();\n      }\n\n      // 自定义sku校验\n      if (this.customSkuValidator) {\n        const err = this.customSkuValidator(this);\n        if (err) return err;\n      }\n\n      return '请先选择商品规格';\n    },\n\n    onClose() {\n      this.show = false;\n    },\n\n    onSelect(skuValue) {\n      // 点击已选中的sku时则取消选中\n      this.selectedSku =\n        this.selectedSku[skuValue.skuKeyStr] === skuValue.id\n          ? { ...this.selectedSku, [skuValue.skuKeyStr]: UNSELECTED_SKU_VALUE_ID }\n          : { ...this.selectedSku, [skuValue.skuKeyStr]: skuValue.id };\n\n      this.$emit('sku-selected', {\n        skuValue,\n        selectedSku: this.selectedSku,\n        selectedSkuComb: this.selectedSkuComb\n      });\n    },\n\n    onNumChange(num) {\n      this.selectedNum = num;\n    },\n\n    onOverLimit(data) {\n      const { action, limitType, quota, quotaUsed } = data;\n      const { handleOverLimit } = this.customStepperConfig;\n\n      if (handleOverLimit) {\n        handleOverLimit(data);\n        return;\n      }\n\n      if (action === 'minus') {\n        Toast('至少选择一件');\n      } else if (action === 'plus') {\n        if (limitType === QUOTA_LIMIT) {\n          let msg = `限购${quota}件`;\n          if (quotaUsed > 0) msg += `，${`你已购买${quotaUsed}件`}`;\n          Toast(msg);\n        } else {\n          Toast('库存不足');\n        }\n      }\n    },\n\n    onAddCart() {\n      this.onBuyOrAddCart('add-cart');\n    },\n\n    onBuy() {\n      this.onBuyOrAddCart('buy-clicked');\n    },\n\n    onBuyOrAddCart(type) {\n      const error = this.validateSku();\n      if (error) {\n        Toast(error);\n      } else {\n        this.$emit(type, this.getSkuData());\n      }\n    },\n\n    getSkuData() {\n      return {\n        goodsId: this.goodsId,\n        selectedNum: this.selectedNum,\n        selectedSkuComb: this.selectedSkuComb,\n        messages: this.getSkuMessages(),\n        cartMessages: this.getSkuCartMessages()\n      };\n    }\n  }\n});\n</script>\n"],"sourceRoot":"node_modules/healen-x-ui/packages/sku"}]}